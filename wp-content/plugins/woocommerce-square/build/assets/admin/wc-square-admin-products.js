jQuery(document).ready((e=>{const s=window.typenow||"",a=window.pagenow||"",__=wp.i18n.__;if("product"===s&&wc_square_admin_products.is_product_sync_enabled){if("product_page_product_importer"===a){const i='<div class="error"><p>'+__("Product syncing with square has been enabled. If you are trying to update product inventory, you should do it in Square. Your existing inventory data in WooCommerce will be overwritten with data from Square products.","woocommerce-square")+"</p></div>";e(".wc-progress-steps").after(i)}if("edit-product"===a&&e("#the-list").on("click",".editinline",(s=>{const a=e(s.target).closest("tr"),t=a.find("th.check-column input").val(),i={action:"wc_square_get_quick_edit_product_details",security:wc_square_admin_products.get_quick_edit_product_details_nonce,product_id:a.find("th.check-column input").val()};e.post(wc_square_admin_products.ajax_url,i,(s=>{const a=e("tr#edit-"+t),i=a.find("select.square-synced"),r=a.find(".wc-square-sync-with-square-errors");if(!s.success&&s.data&&"missing_variation_sku"===s.data)return i.prop("checked",!1),i.prop("disabled",!0),void r.find(".missing_variation_sku").show();const c=a.find("input[name=_sku]"),o=a.find("select[name=_stock_status]"),n=a.find("input[name=_stock]"),d=a.find(".manage_stock_field .manage_stock"),_=a.find("input[name=_manage_stock]"),p='<span class="description"><a href="'+wc_square_admin_products.settings_url+'">'+wc_square_admin_products.i18n.synced_with_square+"</a></span>",u=s.data.edit_url,l=s.data.i18n,h=s.data.is_variable;i.val(s.data.is_synced_with_square),c.on("change keyup keypress",(s=>{if(""!==e(s.target).val()||h)return i.prop("disabled",!1),i.trigger("change"),r.find(".missing_sku").hide();i.val("no").trigger("change"),i.prop("disabled",!0),r.find(".missing_sku").show()})).trigger("change"),i.on("change",(s=>{wc_square_admin_products.is_inventory_sync_enabled&&("no"===e(s.target).val()?(_.off(),_.add(n).css({opacity:1}),d.find(".description").remove(),h?_.is(":checked")?(e(".stock_qty_field").show(),e(".backorder_field").show()):e(".stock_status_field").show():(n.prop("readonly",!1),o.prop("readonly",!1))):(_.on("click",(()=>!1)),_.add(n).css({opacity:"0.5"}),d.append(p),wc_square_admin_products.is_woocommerce_sor&&u&&l&&d.append('<p class="description"><a href="'+u+'">'+l+"</a></p>"),h?(e(".stock_status_field").hide(),e(".stock_qty_field").hide(),e(".backorder_field").hide()):(n.prop("readonly",!0),o.prop("readonly",!0))))})).trigger("change")}))})),"product"===a){const r="#_"+wc_square_admin_products.synced_with_square_taxonomy,c=()=>wc_square_admin_products.variable_product_types.includes(e("#product-type").val()),o=()=>""!==e("#_sku").val().trim(),n=s=>!!s.length&&s.filter((s=>""!==e(s).val().trim())).length===s.length,d=s=>{const a=s.map((s=>e(s).val()));return a.every((e=>a.indexOf(e)===a.lastIndexOf(e)))},_=()=>{const s=e('.woocommerce_attribute_data input[name^="attribute_variation"]:checked');return c()&&s&&s.length>1},p=s=>{e(".wc-square-sync-with-square-error."+s).show(),e(r).prop("disabled",!0),e(r).prop("checked",!1)},u=(s,a=!0)=>{e(".wc-square-sync-with-square-error."+s).hide(),a&&e(r).prop("disabled",!1)},l=s=>{if(c()){e("#_sku").off("change keypress keyup"),u("missing_sku",!_());const a=e('input[id^="variable_sku"]');a.on("change keypress keyup",(()=>{n(e.makeArray(a))&&d(e.makeArray(a))?u("missing_variation_sku",!_()):p("missing_variation_sku"),e(s).triggerHandler("change")})).triggerHandler("change")}else e('input[id^="variable_sku"]').off("change keypress keyup"),u("missing_variation_sku",!_()),e("#_sku").on("change keypress keyup",(a=>{""===e(a.target).val().trim()?p("missing_sku"):u("missing_sku",!_()),e(s).trigger("change")})).trigger("change")},h=s=>{e("#variable_product_options").on("reload",(()=>{o()&&e(s).prop("disabled",!1),e(s).trigger("change")})).trigger("reload")},f=()=>{l(r),e(r).trigger("change"),c()&&!e('input[id^="variable_sku"]').length&&p("missing_variation_sku")},m=s=>{const a=e(".wc-square-sync-with-square");wc_square_admin_products.supported_products_for_sync.includes(s)?a.show():a.hide()};h(r);const k=e(".stock_fields"),y=k.find("#_stock"),g=e(".stock_status_field"),v=e("._manage_stock_field"),w=v.find("#_manage_stock"),q=v.find(".description"),b=q.text(),x=e("#_manage_stock").is(":checked");e(r).on("change",(s=>{if(!wc_square_admin_products.is_inventory_sync_enabled)return;const a=wc_square_admin_products.variable_product_types.includes(e("#product-type").val());let t;if(e(s.target).is(":checked")&&e("#_square_item_variation_id").length>0){t=!0;let s="";w.is(":checked")||a||(s=' (<a href="#" class="sync-stock-from-square" data-product-id="'+e("#post_ID").val()+'">'+wc_square_admin_products.i18n.sync_inventory+'</a>)<div class="sync-stock-spinner spinner" style="float:none;"></div>'),q.html('<a href="'+wc_square_admin_products.settings_url+'">'+wc_square_admin_products.i18n.synced_with_square+"</a>"+s),w.on("click",(()=>!1)),w.css({opacity:"0.5"}),y.prop("readonly",!0),wc_square_admin_products.is_woocommerce_sor&&!a?(0===e("p._stock_field span.description").length&&y.after('<span class="description" style="display:block;clear:both;"><a href="#" id="fetch-stock-with-square">'+wc_square_admin_products.i18n.fetch_stock_with_square+'</a><div class="spinner" style="float:none;"></div></span>'),e("#fetch-stock-with-square").on("click",(s=>{s.preventDefault();const a=e("p._stock_field span.description .spinner"),t={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:e("#post_ID").val()};a.css("visibility","visible"),e.post(wc_square_admin_products.ajax_url,t,(s=>{if(s&&s.success){const a=s.data.quantity;s.data.manage_stock||(w.prop("checked",!1).trigger("change"),e("#_stock_status").val("instock"),q.html('<a href="'+wc_square_admin_products.settings_url+'">'+wc_square_admin_products.i18n.inventory_tracking_disabled+"</a>")),y.val(a),k.find("input[name=_original_stock]").val(a),y.prop("readonly",!1),e("p._stock_field span.description").remove()}else s.data&&(e(".inventory-fetch-error").remove(),a.after('<span class="inventory-fetch-error" style="display:inline-block;color:red;">'+s.data+"</span>")),a.css("visibility","hidden")}))}))):wc_square_admin_products.is_square_sor&&0===e("p._stock_field span.description").length&&y.after('<span class="description" style="display:block;clear:both;">'+wc_square_admin_products.i18n.managed_by_square+' (<a href="#" class="sync-stock-from-square" data-product-id="'+e("#post_ID").val()+'">'+wc_square_admin_products.i18n.sync_stock_from_square+'</a>)<div class="sync-stock-spinner spinner" style="float:none;"></div></span>')}else t=!1,e("p._stock_field span.description").remove(),y.prop("readonly",!1),q.html(b),w.off("click"),w.css({opacity:1}),w.prop("checked",x),a||(x?(k.show(),g.hide()):(g.show(),k.hide()));e(".woocommerce_variation").each(((s,a)=>{const i=e(a).find("h3 input.variable_post_id").val(),r=e(a).find(".variable_manage_stock"),c=r.parent(),o=e(a).find(".wc_input_stock"),n=o.parent();if(t){if(o.prop("readonly",!0),r.on("click",(()=>!1)),r.css({opacity:"0.5"}),0===c.find(".description").length){let e="";r.is(":checked")||(e=' - <a href="#" class="sync-stock-from-square" data-product-id="'+i+'">'+wc_square_admin_products.i18n.sync_inventory+'</a><div class="sync-stock-spinner spinner" style="float:none;"></div>'),r.after('(<span class="description">'+wc_square_admin_products.i18n.managed_by_square+"</span>)"+e)}if(wc_square_admin_products.is_woocommerce_sor){const s="fetch-stock-with-square-"+i;0===n.find("span.description").length&&o.after('<span class="description" style="display:block;clear:both;"><a href="#" id="'+s+'">'+wc_square_admin_products.i18n.fetch_stock_with_square+'</a><div class="spinner" style="float:none;"></div></span>'),e("#"+s).on("click",(s=>{s.preventDefault();const a=e(s.target).next(".spinner"),t={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:i};a.css("visibility","visible"),e.post(wc_square_admin_products.ajax_url,t,(s=>{if(s&&s.success){const e=s.data.quantity;s.data.manage_stock||r.prop("checked",!1).trigger("change"),o.val(e),n.parent().find('input[name^="variable_original_stock"]').val(e),o.prop("readonly",!1),n.find(".description").remove()}else s.data&&(e(".inventory-fetch-error").remove(),a.after('<span class="inventory-fetch-error" style="display:inline-block;color:red;">'+s.data+"</span>")),a.css("visibility","hidden")}))}))}else wc_square_admin_products.is_square_sor&&0===n.find("span.description").length&&o.after('<span class="description" style="display:block;clear:both;"><a href="#" class="sync-stock-from-square" data-product-id="'+i+'">'+wc_square_admin_products.i18n.sync_stock_from_square+'</a><div class="sync-stock-spinner spinner" style="float:none;"></span>')}else o.prop("readonly",!1),r.off("click"),r.css({opacity:1}),r.next(".description").remove()}))})).trigger("change"),e("#product-type").on("change",(s=>{"complete"===document.readyState&&f(),m(e(s.target).val())})).trigger("change"),e("#woocommerce-product-data").on("click",".sync-stock-from-square",(s=>{s.preventDefault();const a=e(s.target).data("product-id"),t=e(".sync-stock-spinner.spinner"),i={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:a};t.css("visibility","visible"),e.post(wc_square_admin_products.ajax_url,i,(()=>{t.css("visibility","hidden"),window.location.reload()}))})),e("#product-type, #_square_gift_card").on("change",(function(){const s=e("#product-type").val(),a=e("#_square_gift_card").prop("checked");let t=[e(".wc-square-sync-with-square"),e(".inventory_sold_individually"),e('label[for="_virtual"]'),e('label[for="_downloadable"]'),e("._tax_status_field").closest(".options_group")];"variable"===s&&(t=[...t,e(".variable_is_virtual").closest(".tips"),e(".variable_is_downloadable").closest(".tips")]),a?(e("#_virtual").prop("checked")||e("#_virtual").trigger("click").prop("checked",!0),e(".variable_is_virtual").each(((s,a)=>{e(a).prop("checked")||e(a).trigger("click").prop("checked",!0)})),t.forEach((e=>e.hide()))):(t.forEach((e=>e.show())),"variable"===s&&(e('label[for="_virtual"]').hide(),e('label[for="_downloadable"]').hide()))})).trigger("change"),e("#woocommerce-product-data").on("click",".sync-stock-from-square",(s=>{s.preventDefault();const a=e(s.target).data("product-id"),t=e(".sync-stock-spinner.spinner"),i={action:"wc_square_fetch_product_stock_with_square",security:wc_square_admin_products.fetch_product_stock_with_square_nonce,product_id:a};t.css("visibility","visible"),e.post(wc_square_admin_products.ajax_url,i,(()=>{t.css("visibility","hidden"),window.location.reload()}))}));let D=null;function t(){let s=document.querySelector(".woocommerce_variations");!D&&s&&(D=new MutationObserver((()=>{e("#_square_gift_card").trigger("change")})),D&&D.observe(s,{attributes:!1,childList:!0,subtree:!1}))}t(),e("#woocommerce-product-data").on("woocommerce_variations_loaded woocommerce_variations_added woocommerce_variations_removed",(()=>{t(),f()}))}}}));