(()=>{"use strict";var e={20:(e,t,a)=>{var n=a(609),o=Symbol.for("react.element"),r=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,a){var n,r={},d=null,p=null;for(n in void 0!==a&&(d=""+a),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(p=t.ref),t)s.call(t,n)&&!c.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:o,type:e,key:d,ref:p,props:r,_owner:i.current}}t.Fragment=r,t.jsx=d,t.jsxs=d},848:(e,t,a)=>{e.exports=a(20)},609:e=>{e.exports=window.React}},t={};const a=window.wp.htmlEntities,n=window.wc.wcBlocksRegistry,o=window.wp.i18n,r=window.wp.element,s=window.wc.wcSettings,i=window.wp.data,c="square_cash_app_pay",{PAYMENT_STORE_KEY:d}=window.wc.wcBlocksData;let p=null;const u=()=>{if(null!==p)return p;const e=(0,s.getSetting)("square_cash_app_pay_data",null);if(!e)throw new Error("Square Cash App Pay initialization data is not available");return p={title:e.title||"",description:e.description||"",applicationId:e.application_id||"",locationId:e.location_id||"",isSandbox:e.is_sandbox||!1,loggingEnabled:e.logging_enabled||!1,generalError:e.general_error||"",showSavedCards:e.show_saved_cards||!1,showSaveOption:e.show_save_option||!1,supports:e.supports||{},isPayForOrderPage:e.is_pay_for_order_page||!1,orderId:e.order_id||"",ajaxUrl:e.ajax_url||"",paymentRequestNonce:e.payment_request_nonce||"",continuationSessionNonce:e.continuation_session_nonce||"",gatewayIdDasherized:e.gateway_id_dasherized||"",buttonStyles:e.button_styles||{},isContinuation:e.is_continuation||!1,refereneceId:e.reference_id||""},p},l=e=>u().ajaxUrl.replace("%%endpoint%%",`square_cash_app_pay_${e}`),w=(e=!1)=>new Promise(((t,a)=>{const n={security:u().continuationSessionNonce,clear:e};jQuery.post(l("set_continuation_session"),n,(e=>e.success?t(e.data):a(e.data)))})),y=(e,t="notice")=>{u().loggingEnabled&&("error"===t?console.error(e):console.log(e))};var _=function a(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,a),r.exports}(848);const h="wc-square-cash-app-pay",S=e=>{const[t,n]=(0,r.useState)(null),[o,s]=(0,r.useState)(!1),[i,d]=(0,r.useState)(""),{applicationId:p,locationId:S,buttonStyles:m,referenceId:f,generalError:g,gatewayIdDasherized:P,description:C}=u(),{onSubmit:v,emitResponse:q,eventRegistration:E,billing:{cartTotal:b,currency:x},components:{LoadingMask:R},activePaymentMethod:A}=e,{onPaymentSetup:I}=E;return(0,r.useEffect)((()=>I((()=>{if(!i)return{type:q.responseTypes.ERROR,message:g};const e={[`wc-${P}-payment-nonce`]:i||""};return{type:q.responseTypes.SUCCESS,meta:{paymentMethodData:e}}}))),[q.responseTypes.SUCCESS,q.responseTypes.ERROR,I,i,P,g]),(0,r.useEffect)((()=>{if(s(!1),n(null),!window.Square)return;y("[Square Cash App Pay] Initializing Square Cash App Pay Button");const e=window.Square.payments(p,S);return e?(async function t(){s(!1);try{const a=await(async e=>{const t=await new Promise(((e,t)=>{const a={security:u().paymentRequestNonce,is_pay_for_order_page:u().isPayForOrderPage||!1,order_id:u().orderId||0};jQuery.post(l("get_payment_request"),a,(a=>a.success?e(a.data):t(a.data)))})),a=JSON.parse(t);return e.paymentRequest(a)})(e);window.wcSquareCashAppPay&&(await window.wcSquareCashAppPay.destroy(),window.wcSquareCashAppPay=null);const o=await e.cashAppPay(a,{redirectURL:window.location.href,referenceId:f});await o.attach(`#${h}`,m),o.addEventListener("ontokenization",(e=>{const{tokenResult:a,error:o}=e.detail;if(o)d(""),n(o.message);else if("OK"===a.status){const e=a.token;e||(d(""),n(g)),d(e),v()}else d(null),t()})),o.addEventListener("customerInteraction",(e=>{if(e.detail&&e.detail.isMobile)return w()})),window.wcSquareCashAppPay=o,y("[Square Cash App Pay] Square Cash App Pay Button Loaded")}catch(e){n(g),console.error(e)}s(!0)}(),()=>(async()=>{window.wcSquareCashAppPay&&(await window.wcSquareCashAppPay.destroy(),window.wcSquareCashAppPay=null)})()):void 0}),[b.value,x.code,p,S,g,f]),(0,r.useEffect)((()=>{const e=document.querySelector("button.wc-block-components-checkout-place-order-button");if(e)return A!==c||i||e.setAttribute("disabled","disabled"),()=>{e.removeAttribute("disabled")}}),[A,i]),(0,_.jsxs)(_.Fragment,{children:[(0,_.jsx)("p",{children:(0,a.decodeEntities)(C||"")}),t&&(0,_.jsx)("div",{className:"woocommerce-error",children:t}),!t&&(0,_.jsx)(R,{isLoading:!o,showSpinner:!0,children:(0,_.jsx)("div",{id:h})})]})},{title:m,applicationId:f,locationId:g}=u(),P=e=>{const{PaymentMethodLabel:t}=e.components;return(0,_.jsx)(t,{text:(0,a.decodeEntities)(m)})},C=({RenderedComponent:e,isEdit:t,...a})=>t?null:(0,_.jsx)(e,{...a}),v={name:c,label:(0,_.jsx)(P,{}),paymentMethodId:c,ariaLabel:(0,o.__)("Cash App Pay payment method","woocommerce-square"),content:(0,_.jsx)(C,{RenderedComponent:S}),edit:(0,_.jsx)(C,{RenderedComponent:S,isEdit:!0}),canMakePayment:({billingData:e,cartTotals:t})=>{const a=f&&g,n="US"===e.country,o="USD"===t.currency_code,r=a&&n&&o;return r&&(()=>{const e=document&&document.getElementById("radio-control-wc-payment-method-options-square_cash_app_pay");u().isContinuation&&!window.wcSquareCashAppPaySelected&&e&&(y("[Square Cash App Pay] Selecting Cash App Pay payment method"),(0,i.dispatch)(d).__internalSetActivePaymentMethod(c),window.wcSquareCashAppPaySelected=!0,w(!0))})(),r},supports:{features:u().supports||[],showSavedCards:u().showSavedCards||!1,showSaveOption:u().showSaveOption||!1}};(0,n.registerPaymentMethod)(v)})();