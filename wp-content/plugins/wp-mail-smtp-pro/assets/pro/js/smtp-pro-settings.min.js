"use strict";var WPMailSMTP=window.WPMailSMTP||{};WPMailSMTP.Admin=WPMailSMTP.Admin||{},WPMailSMTP.Admin.Settings=WPMailSMTP.Admin.Settings||{},WPMailSMTP.Admin.Settings.Pro=WPMailSMTP.Admin.Settings.Pro||function(i,l,c){var r=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},p={doingAjax:!1,init:function(){c(p.ready)},ready:function(){p.pageHolder=c(".wp-mail-smtp-tab-settings"),p.settingsForm=c(".wp-mail-smtp-connection-settings-form"),p.bindActions()},bindActions:function(){p.license.bindActions(),p.amazonses.bindActions(),p.amazonses.loadIdentities(),p.gmail.bindActions(),p.outlook.bindActions(),p.multisite.bindActions(),p.webhooks.bindActions(),p.additionalConnections.bindActions(),c(i).on("click",".notice-wp_mail_logging_importer .notice-dismiss",function(e){e.preventDefault();e=c(this).parent(".notice");e.length<=0||!e.data("nonce")||c.post(ajaxurl,{action:"wp_mail_smtp_wp_mail_logging_importer_notice_dismiss",nonce:e.data("nonce")})})},license:{getNoticeHtml:function(e,t){return'<div class="notice '+e+' wp-mail-smtp-license-notice is-dismissible"><p>'+t+"</p>"},bindActions:function(){p.pageHolder.on("keydown","#wp-mail-smtp-setting-license-key",this.inputEnter),p.pageHolder.on("click","#wp-mail-smtp-setting-license-key-verify",this.verify),p.pageHolder.on("click","#wp-mail-smtp-setting-license-key-deactivate",this.deactivate),p.pageHolder.on("click","#wp-mail-smtp-setting-license-key-refresh",this.refresh)},verify:function(e){e.preventDefault();var s=jQuery(e.target),a=s.closest(".wp-mail-smtp-setting-row"),o=c("#wp-mail-smtp-setting-license-key",a),e={action:"wp_mail_smtp_pro_license_ajax",task:"license_verify",nonce:c("#wp-mail-smtp-setting-license-nonce",a).val(),license:o.val()};s.prop("disabled",!0),c.post(ajaxurl,e,function(e){var t,i,n;e.success?(t=e.data.message,i="check-circle-solid-green",n="green",c("#wp-mail-smtp-setting-field-license").replaceWith(e.data.settings_html)):(t=e.data,i="exclamation-circle-regular-red",n="red",a.find(".type, .desc, #wp-mail-smtp-setting-license-key-deactivate").hide(),o.prop("disabled",!1));p.license.displayModal(t,i,n,function(){l.location.reload()}),s.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},inputEnter:function(e){13===e.keyCode&&(e.preventDefault(),c("#wp-mail-smtp-setting-license-key-verify").trigger("click"))},deactivate:function(e){e.preventDefault();var s=jQuery(e.target),a=s.closest(".wp-mail-smtp-setting-row"),e={action:"wp_mail_smtp_pro_license_ajax",task:"license_deactivate",nonce:c("#wp-mail-smtp-setting-license-nonce",a).val()};s.prop("disabled",!0),c.post(ajaxurl,e,function(e){var t,i,n;e.success?(t=e.data.message,i="check-circle-solid-green",n="green",c("#wp-mail-smtp-setting-field-license").replaceWith(e.data.settings_html)):(t=e.data,i="exclamation-circle-regular-red",n="red"),c("#wp-mail-smtp-setting-license-key",a).prop("disabled",!1),p.license.displayModal(t,i,n),s.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},refresh:function(e){e.preventDefault();var s=jQuery(e.target),a=s.closest(".wp-mail-smtp-setting-row"),e={action:"wp_mail_smtp_pro_license_ajax",task:"license_refresh",nonce:c("#wp-mail-smtp-setting-license-nonce",a).val()};s.prop("disabled",!0),c.post(ajaxurl,e,function(e){var t,i,n;e.success?(t=e.data.message,i="check-circle-solid-green",n="green",c("#wp-mail-smtp-setting-field-license").replaceWith(e.data.settings_html)):(t=e.data,i="exclamation-circle-regular-red",n="red",a.find(".desc, #wp-mail-smtp-setting-license-key-deactivate").hide(),c("#wp-mail-smtp-setting-license-key",a).prop("disabled",!1));p.license.displayModal(t,i,n,function(){l.location.reload()}),s.prop("disabled",!1)}).fail(function(e){console.log(e.responseText)})},displayModal:function(e,t,i,n){p.displayModal(e,t,i,n)}},amazonses:{bindActions:function(){c(i).on("click",".js-wp-mail-smtp-providers-amazonses-register-identity",this.processIdentityRegistration),c(i).on("change",".js-wp-mail-smtp-providers-amazonses-register-identity-radio-button",this.processIdentityTypeToggling),c(i).on("click",".js-wp-mail-smtp-ses-dkim-records-copy-btn",this.processTxtCodeCopy),c(i).on("blur","#wp-mail-smtp-providers-amazonses-domain-input",function(){var e=c(this);e.val(e.val().replace("https://","").replace("http://",""))}),c(i).on("keydown","#wp-mail-smtp-providers-amazonses-domain-input, #wp-mail-smtp-providers-amazonses-email-input",function(e){13===e.which&&c(".js-wp-mail-smtp-providers-amazonses-register-identity").trigger("click")}),p.settingsForm.on("click",".js-wp-mail-smtp-providers-amazonses-register-identity-modal-button",this.openRegisterIdentityModal),p.settingsForm.on("click",".js-wp-mail-smtp-providers-amazonses-identity-delete",this.processIdentityDelete),p.settingsForm.on("click",".js-wp-mail-smtp-providers-amazonses-email-resend",this.processEmailResend),p.settingsForm.on("click",".js-wp-mail-smtp-providers-amazonses-domain-dns-record",this.displayDnsRecord),p.settingsForm.on("submit",this.maybePreventSettingsSave),c(i).on("focus",".js-wp-mail-smtp-ses-dkim-records-input",function(){c(this).trigger("select")})},loadIdentities:function(){var t,e;"amazonses"!==c(".js-wp-mail-smtp-setting-mailer-radio-input:checked").val()||void 0!==(e=(t=c(".js-wp-mail-smtp-ses-identities-setting")).siblings('input[name="wp_mail_smtp_pro_amazonses_load_ses_identities"]').val())&&e.length&&c.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"load_ses_identities",connection_id:wp_mail_smtp_pro.connection_id,mailer:"amazonses",nonce:e},beforeSend:function(){p.doingAjax=!0}}).done(function(e){e.hasOwnProperty("success")&&e.success?t.html(e.data):t.html('<p class="response response-error">'+wp_mail_smtp_pro.ses_text_no_identities+"</p>")}).fail(function(){t.html('<p class="response response-error">'+wp_mail_smtp_pro.ses_text_no_identities+"</p>")}).always(function(){p.doingAjax=!1})},processIdentityTypeToggling:function(){var e=c(this).closest("#wp-mail-smtp-providers-amazonses-register-identity"),t=e.find("#wp-mail-smtp-providers-amazonses-domain-input"),i=e.find("#wp-mail-smtp-providers-amazonses-domain-desc"),n=e.find("#wp-mail-smtp-providers-amazonses-email-input"),e=e.find("#wp-mail-smtp-providers-amazonses-email-desc");"domain"===this.value?(t.show(),i.show(),n.hide(),e.hide()):(t.hide(),i.hide(),n.show(),e.show())},processIdentityRegistration:function(e){e.preventDefault();var t=c(e.target),i=t.closest("#wp-mail-smtp-providers-amazonses-register-identity"),n=i.find("#wp-mail-smtp-providers-amazonses-domain-input"),s=i.find("#wp-mail-smtp-providers-amazonses-email-input"),a=i.find('input[name="wp_mail_smtp_pro_amazonses_register_identity"]').val(),o=i.find('input[name="identity-type"]:checked').val(),e=("email"===o?s:n).val();return!t.hasClass("disabled")&&("email"!==o||r(e)?void(e.length&&a.length&&c.ajax(p.amazonses.getIdentityRegistrationRequestData(o,e,a,function(){i.find("p.response").remove(),t.html(wp_mail_smtp_pro.loader_white_small).addClass("disabled with-loader"),p.doingAjax=!0})).done(function(e){e.hasOwnProperty("success")&&e.success&&(n.val(""),s.val(""),p.amazonses.loadIdentities()),i.slideUp(500,function(){i.empty().append(e.data).slideDown(300,function(){c(".js-wp-mail-smtp-btn-close").show()})})}).fail(function(){i.slideUp(500,function(){i.empty().append("<p>"+wp_mail_smtp_pro.ses_text_smth_wrong+"</p>").slideDown(300,function(){c(".js-wp-mail-smtp-btn-close").show()})})}).always(function(){t.removeClass("disabled"),p.doingAjax=!1})):(i.find("p.response").remove(),i.append('<p class="response error">'+wp_mail_smtp_pro.ses_text_email_invalid+"</p>"),!1))},getIdentityRegistrationRequestData:function(e,t,i,n){return{url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"identity_registration",connection_id:wp_mail_smtp_pro.connection_id,mailer:"amazonses",type:e,value:t,nonce:i},beforeSend:n}},openRegisterIdentityModal:function(e){e.preventDefault(),c.alert({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,closeIcon:!0,type:"blue",boxWidth:"550px",title:wp_mail_smtp_pro.ses_add_identity_modal_title,content:wp_mail_smtp_pro.ses_add_identity_modal_content,buttons:{cancel:{text:wp_mail_smtp_pro.ses_text_done,btnClass:"js-wp-mail-smtp-btn-close btn-hide btn-confirm"}},onOpenBefore:function(){this.$body.addClass("wp-mail-smtp-providers-amazonses-register-identity-modal")}})},processIdentityDelete:function(e){e.preventDefault();var t=c(e.target).closest("a"),i=t.data("identity"),n=t.data("type"),e=t.data("nonce").toString();p.amazonses.deleteIdentity(t,n,i,e)},deleteIdentity:function(e,t,i,n){c.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"orange",boxWidth:"450px",icon:'"></i><img src="'+wp_mail_smtp_pro.plugin_url+'/assets/images/font-awesome/exclamation-circle-solid-orange.svg" style="width: 40px; height: 40px;" alt="'+wp_mail_smtp_pro.icon+'"><i class="',title:!1,content:wp_mail_smtp_pro["ses_text_"+t+"_delete"],buttons:{confirm:{text:wp_mail_smtp_pro.ses_text_yes,btnClass:"btn-confirm",keys:["enter"],action:function(){p.amazonses.deleteIdentityAction(e,t,i,n)}},cancel:{text:wp_mail_smtp_pro.ses_text_cancel,btnClass:"btn-cancel"}}})},deleteIdentityAction:function(t,e,i,n){i.length&&n.length&&c.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"identity_delete",connection_id:wp_mail_smtp_pro.connection_id,mailer:"amazonses",type:e,value:i,nonce:n},beforeSend:function(){p.doingAjax=!0}}).done(function(e){e.hasOwnProperty("success")&&e.success?t.closest("tr").fadeOut("fast",function(){this.remove()}):alert(e.data)}).fail(function(){alert(wp_mail_smtp_pro.ses_text_smth_wrong)}).always(function(){p.doingAjax=!1})},processEmailResend:function(e){e.preventDefault();var t=c(e.target).closest("a"),i=t.data("email"),e=t.data("nonce").toString();return!t.hasClass("disabled")&&(r(i)?void(i.length&&e.length&&c.ajax(p.amazonses.getIdentityRegistrationRequestData("email",i,e,function(){t.addClass("disabled"),t.text(wp_mail_smtp_pro.ses_text_sending),p.doingAjax=!0})).done(function(e){e.hasOwnProperty("success")&&e.success?t.html('<span class="dashicons dashicons-yes"></span> '+wp_mail_smtp_pro.ses_text_sent).fadeOut(1e3,function(){c(this).text(wp_mail_smtp_pro.ses_text_resend),c(this).fadeIn("fast")}):t.html('<span class="dashicons dashicons-no"></span> '+wp_mail_smtp_pro.ses_text_resend_failed).addClass("error")}).fail(function(){alert(wp_mail_smtp_pro.ses_text_smth_wrong)}).always(function(){t.removeClass("disabled"),p.doingAjax=!1})):(alert(wp_mail_smtp_pro.ses_text_smth_wrong),!1))},displayDnsRecord:function(e){e.preventDefault();var e=c(e.target).closest("a"),t=e.data("domain"),i=e.data("nonce");c.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,boxWidth:"550px",content:function(){return p.amazonses.loadDnsRecords(t,i,this)},buttons:{confirm:{text:wp_mail_smtp_pro.ses_text_close,btnClass:"btn-confirm",keys:["enter"]}}})},loadDnsRecords:function(e,t,i){return c.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_providers_ajax",task:"load_dns_records",connection_id:wp_mail_smtp_pro.connection_id,domain:e,mailer:"amazonses",nonce:t},beforeSend:function(){p.doingAjax=!0,i.setTitle(wp_mail_smtp_pro.ses_text_loading)}}).done(function(e){e.hasOwnProperty("success")&&e.success?(i.setTitle(wp_mail_smtp_pro.ses_text_dns_dkim_title),i.setType("blue"),i.setIcon(p.getModalIcon("info-circle-blue"))):(i.setTitle(""),i.setType("red"),i.setIcon(p.getModalIcon("exclamation-circle-regular-red"))),i.setContent(e.data)}).fail(function(){i.setTitle(""),i.setType("red"),i.setIcon(p.getModalIcon("exclamation-circle-regular-red")),i.setContent(wp_mail_smtp_pro.ses_text_smth_wrong)}).always(function(){p.doingAjax=!1,i.isOpen()||i.open()})},maybePreventSettingsSave:function(){if(!0===p.doingAjax)return!1},processTxtCodeCopy:function(e){e.preventDefault(),c(this).siblings("input").select(),i.execCommand("Copy");var t=c(this).find(".dashicons");t.removeClass("dashicons-admin-page").addClass("wp-mail-smtp-dashicons-yes-alt-green").fadeOut(1e3,"swing",function(){t.removeClass("wp-mail-smtp-dashicons-yes-alt-green").addClass("dashicons-admin-page").fadeIn(200)})}},gmail:{bindActions:function(){c(i).on("change","#wp-mail-smtp-setting-gmail-one_click_setup_enabled",this.processOneClickSetupToggling)},processOneClickSetupToggling:function(){var e=c(".wp-mail-smtp-mailer-option__group--gmail-one_click_setup"),t=c(".wp-mail-smtp-mailer-option__group--gmail-custom");c(this).is(":checked")?(e.show(),t.hide()):(e.hide(),t.show())}},outlook:{bindActions:function(){c(i).on("change","#wp-mail-smtp-setting-outlook-one_click_setup_enabled",this.processOneClickSetupToggling)},processOneClickSetupToggling:function(){var e=c(".wp-mail-smtp-mailer-option__group--outlook-one_click_setup"),t=c(".wp-mail-smtp-mailer-option__group--outlook-custom");c(this).is(":checked")?(e.show(),t.hide()):(e.hide(),t.show())}},webhooks:{bindActions:function(){c(i).on("click",".js-wp-mail-smtp-webhooks-subscribe",this.subscribe),c(i).on("click",".js-wp-mail-smtp-webhooks-unsubscribe",this.unsubscribe)},subscribe:function(e){e.preventDefault();var t=c(this);t.addClass("wp-mail-smtp-loading-spin"),c.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_webhooks_subscribe",nonce:wp_mail_smtp_pro.nonce},beforeSend:function(){p.doingAjax=!0}}).done(function(e){var t=e.data,i="check-circle-solid-green",n="green";e.success||(i="exclamation-circle-regular-red",n="red"),p.displayModal(t,i,n,function(){return location.reload(),!1})}).fail(function(){p.displayModal(wp_mail_smtp_pro.error_occurred,"exclamation-circle-regular-red","red")}).always(function(){p.doingAjax=!1,t.removeClass("wp-mail-smtp-loading-spin")})},unsubscribe:function(e){e.preventDefault();var t=c(this);t.addClass("wp-mail-smtp-loading-spin"),c.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_webhooks_unsubscribe",nonce:wp_mail_smtp_pro.nonce},beforeSend:function(){p.doingAjax=!0}}).done(function(e){var t=e.data,i="check-circle-solid-green",n="green";e.success||(i="exclamation-circle-regular-red",n="red"),p.displayModal(t,i,n,function(){return location.reload(),!1})}).fail(function(){p.displayModal(wp_mail_smtp_pro.error_occurred,"exclamation-circle-regular-red","red")}).always(function(){p.doingAjax=!1,t.removeClass("wp-mail-smtp-loading-spin")})}},multisite:{bindActions:function(){c(i).on("click",".js-wp-mail-smtp-clear-network-wide-error-notices",this.clearErrorMessages)},clearErrorMessages:function(e){if(e.preventDefault(),p.doingAjax)return!1;c.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wp_mail_smtp_pro_multisite_clear_error_notices",_ajax_nonce:wp_mail_smtp_pro.nonce},beforeSend:function(){p.doingAjax=!0}}).done(function(e){if(e.success)return l.location.reload(),!1}).always(function(){p.doingAjax=!1})}},additionalConnections:{bindActions:function(){c(i).on("click",".js-wp-mail-smtp-delete-additional-connection",this.processConnectionDelete),c(i).on("click",".js-wp-mail-smtp-switch-additional-connection-with-primary",this.processConnectionSwitchWithPrimary)},processConnectionDelete:function(e){e.preventDefault();var t=c(this),i=t.data("relation"),e=wp_mail_smtp_pro.text_delete_connection;"backup"===i?e=wp_mail_smtp_pro.text_delete_backup_connection:"routing"===i&&(e=wp_mail_smtp_pro.text_delete_smart_routing_connection),c.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"none"===i?"orange":"red",icon:p.getModalIcon("exclamation-circle-solid-"+("none"===i?"orange":"red")),title:wp_mail_smtp_pro.text_heads_up_title,content:e,buttons:{confirm:{text:wp_mail_smtp_pro.text_yes_delete,btnClass:"btn-confirm",keys:["enter"],action:function(){l.location=t.attr("href")}},cancel:{text:wp_mail_smtp_pro.text_cancel,btnClass:"btn-cancel"}}})},processConnectionSwitchWithPrimary:function(e){e.preventDefault();var t=c(this);c.confirm({backgroundDismiss:!1,escapeKey:!0,animationBounce:1,type:"orange",icon:p.getModalIcon("exclamation-circle-solid-orange"),title:wp_mail_smtp_pro.text_heads_up_title,content:wp_mail_smtp_pro.text_switch_witch_primary_connection,buttons:{confirm:{text:wp_mail_smtp_pro.text_yes,btnClass:"btn-confirm",keys:["enter"],action:function(){l.location=t.attr("href")}},cancel:{text:wp_mail_smtp_pro.text_cancel,btnClass:"btn-cancel"}}})}},displayModal:function(e,t,i,n){n=n||function(){},c.alert({backgroundDismiss:!0,escapeKey:!0,animationBounce:1,type:i=i||"default",title:!1,icon:t?p.getModalIcon(t):"",content:e,buttons:{confirm:{text:wp_mail_smtp_pro.ok,btnClass:"btn-confirm",keys:["enter"],action:n}},onClose:n})},getModalIcon:function(e){return'"></i><img src="'+wp_mail_smtp_pro.plugin_url+"/assets/images/font-awesome/"+e+'.svg" style="width: 40px; height: 40px;" alt="'+wp_mail_smtp_pro.icon+'"><i class="'}};return p}(document,window,jQuery),WPMailSMTP.Admin.Settings.Pro.init();